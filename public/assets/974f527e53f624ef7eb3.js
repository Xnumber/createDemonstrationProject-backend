"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[93],{7093:(e,n,t)=>{t.r(n),t.d(n,{default:()=>$});var r=t(7363),a=t.n(r),o=t(9152),l=t(2327),u=t(2658),c=t(4524),i=t(9449),d=t(6495),f=t(3063),s=t(165),p=t(542),m=t(6446),v=t(476),b=t(7869),y=function(){return y=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},y.apply(this,arguments)},h=["宜蘭縣","花蓮縣","臺東縣","澎湖縣","金門縣","連江縣","臺北市","新北市","桃園市","臺中市","臺南市","高雄市","基隆市","新竹縣","新竹市","苗栗縣","彰化縣","南投縣","雲林縣","嘉義縣","嘉義市","屏東縣"],g=["T","MinT","MaxT"],x=["none","average","moving-average","difference"],E=["max","min","up-trend","up-trend-overlap","down-trend","down-trend-overlap"],k=g.reduce((function(e,n){var t;return y(y({},e),((t={})[n]={backgroundColor:(0,b.m)()},t))}),{}),w=h.reduce((function(e,n){var t;return y(y({},e),((t={})[n]={backgroundColor:(0,b.m)()},t))}),{}),C=t(3875),T=t(1499),O=t(9776),Z=T.A.injectEndpoints({endpoints:function(e){return{getWeatherForcast:e.query({query:function(e){var n=e.locations,t=e.elements;return"F-D0047-091?Authorization=".concat("CWB-99433185-8573-4C40-A443-1B0D612515FF","&locationName=").concat(n.join(","),"&elementName=").concat(t.join(","))},providesTags:["GetWeather"],onQueryStarted:function(e,n){var t,r,a,o,l=n.queryFulfilled;return t=void 0,r=void 0,o=function(){return function(e,n){var t,r,a,o,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(c){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(l=0)),l;)try{if(t=1,r&&(a=2&u[0]?r.return:u[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,u[1])).done)return a;switch(r=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return l.label++,{value:u[1],done:!1};case 5:l.label++,r=u[1],u=[0];continue;case 7:u=l.ops.pop(),l.trys.pop();continue;default:if(!((a=(a=l.trys).length>0&&a[a.length-1])||6!==u[0]&&2!==u[0])){l=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){l.label=u[1];break}if(6===u[0]&&l.label<a[1]){l.label=a[1],a=u;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(u);break}a[2]&&l.ops.pop(),l.trys.pop();continue}u=n.call(e,l)}catch(e){u=[6,e],r=0}finally{t=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}(this,(function(n){switch(n.label){case 0:return(0,O.V)("GetWeather","method: GET, locations: ".concat(e.locations.join(","),", elements: ").concat(e.elements.join(","))),[4,l];case 1:return n.sent(),(0,O.Q)("GetWeather"),[2]}}))},new((a=void 0)||(a=Promise))((function(e,n){function l(e){try{c(o.next(e))}catch(e){n(e)}}function u(e){try{c(o.throw(e))}catch(e){n(e)}}function c(n){var t;n.done?e(n.value):(t=n.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,u)}c((o=o.apply(t,r||[])).next())}))}})}}}),I=Z.useGetWeatherForcastQuery;function S(e,n,t){return e.p0.parsed.y<e.p1.parsed.y?n:t}function N(e,n){var t=n.downTrands,r=n.upTrands,a=e.datasetIndex,o=e.p0DataIndex,l=!0,u=!0;return t[a][o]?t.forEach((function(e){!1===e[o]&&(l=!1)})):l=!1,r[a][o]?r.forEach((function(e){!1===e[o]&&(u=!1)})):u=!1,l?"green":u?"red":void 0}var F=function(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))};function j(e){var n=Math.max.apply(Math,e);return e.reduce((function(e,t,r){return t===n?F(F([],e,!0),[r],!1):e}),[])}function A(e){var n=Math.min.apply(Math,e);return e.reduce((function(e,t,r){return t===n?F(F([],e,!0),[r],!1):e}),[])}var M=function(){return M=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},M.apply(this,arguments)},q=function(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))},D=function(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))},R={average:function(e){var n=e.map((function(e){var n=e.data.reduce((function(e,n){return e+Number(n.y)}),0)/e.data.length;return{label:"".concat(e.label,": 平均"),data:e.data.map((function(e){return{x:e.x,y:n}}))}}));return D(D([],e,!0),n,!0)},difference:function(e,n){var t=[];return n.forEach((function(n){var r=e.find((function(e){return e.label===n[0]})),a=e.find((function(e){return e.label===n[1]}));if(r&&a){var o=r.data.map((function(e,n){return{x:e.x,y:Number(e.y)-Number(a.data[n].y)}}));t.push({label:"".concat(n[0]," - ").concat(n[1]),data:o})}})),D(D([],e,!0),t,!0)},"moving-average":function(e){var n=e.map((function(e){return{label:"".concat(e.label,": 2個資料移動平均"),data:e.data.map((function(n,t){var r=0!==t?(Number(e.data[t].y)+Number(e.data[t-1].y))/2:null;return{x:n.x,y:r}}))}}));return D(D([],e,!0),n,!0)}},L=t(1229),B=t(9220),G=t(5778),P={id:"chartLegend",afterUpdate:function(e){var n,t,r,a,o=null===(a=null===(r=null===(t=null===(n=null==e?void 0:e.options.plugins)||void 0===n?void 0:n.legend)||void 0===t?void 0:t.labels)||void 0===r?void 0:r.generateLabels)||void 0===a?void 0:a.call(r,e);if(o){var l=e.data.datasets.map((function(e){return o.find((function(n){return n.text===e.label}))}));o&&G.h.dispatch(B.o.actions.setLegendItems(l))}}},W=function(){return W=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},W.apply(this,arguments)},V=function(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))},z=t(611),Q=t(4771),U=function(e,n,t){if(t||2===arguments.length)for(var r,a=0,o=n.length;a<o;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))};i.kL.register(i.uw,i.f$,i.od,i.jn,i.Dx,i.u,i.De,i.Gu);const $=function(){var e,n,t,i,b=(0,l.$)("weather-forecast"),y=b.i18n,T=b.t,O=b.ready,Z=(0,r.useState)("location"),F=Z[0],G=Z[1],$=(0,r.useState)(["臺北市"]),H=$[0],K=$[1],J=(0,r.useState)(["MaxT"]),X=J[0],Y=J[1],_=(0,r.useState)([]),ee=_[0],ne=_[1],te=(0,r.useState)([]),re=te[0],ae=te[1],oe=(0,r.useState)([]),le=oe[0],ue=oe[1],ce=(0,r.useRef)(),ie=(0,z.C)((function(e){return e.theme.mode})),de=I({locations:H,elements:X}).data,fe=(0,r.useMemo)((function(){return(0,C.F)(h,T)}),[O]),se=(0,r.useMemo)((function(){return(0,C.F)(g,T)}),[O]),pe=(0,r.useMemo)((function(){return(0,C.F)(E,T)}),[O,y.language]),me=(0,r.useMemo)((function(){return(0,C.F)(x,T)}),[O,y.language]),ve=(0,r.useMemo)((function(){return"location"===F?(0,C.F)(H,T):(0,C.F)(X,T)}),[F,X.length,H.length]),be=(0,z.C)((function(e){return e.weatherLegend.topLayerDatasetIndex})),ye="element"===F?H[0]:X[0],he=(0,r.useCallback)((function(e){G(e.currentTarget.value),K(["臺北市"]),Y(["MaxT"])}),[]),ge=(0,r.useCallback)((function(e){K("string"==typeof e?[e]:e)}),[]),xe=(0,r.useCallback)((function(e,n,t){ue((function(r){return r.map((function(r,a){if(a===e){var o=U([],r,!0);return o[n]=t,o}return r}))}))}),[]),Ee=(0,r.useCallback)((function(){ue((function(e){return U(U([],e,!0),[["",""]],!1)}))}),[]),ke=(0,r.useCallback)((function(e){ue((function(n){return n.filter((function(n,t){return t!==e}))}))}),[]),we=(0,r.useCallback)((function(e){Y("string"==typeof e?[e]:e)}),[]),Ce=(0,r.useCallback)((function(e){ne(e)}),[]),Te=(0,r.useCallback)((function(e){ae([e])}),[]),Oe=function(e,n){var t;if(!e)return[];var r=null===(t=e.records.locations.find((function(e){return"台灣"===e.locationsName})))||void 0===t?void 0:t.location;return r&&"location"===n?function(e){var n=e.map((function(e){return{label:e.locationName,data:e.weatherElement[0].time.map((function(e){var n;return{x:e.startTime,y:Number(null===(n=e.elementValue[0])||void 0===n?void 0:n.value)}}))}}));return n}(r):r&&"element"===n?function(e){var n=e[0]?e[0].weatherElement.map((function(e){return{label:e.elementName,data:e.time.map((function(e){var n;return{x:e.startTime,y:Number(null===(n=e.elementValue[0])||void 0===n?void 0:n.value)}}))}})):[];return n}(r):[]}(de,F),Ze=function(e,n){var t=e.map((function(e,n){return W(W({},e),{order:n+1})}));return e.length>0&&-1!==n?t.reduce((function(e,t,r){return V(V([],e,!0),r===n?[W(W({},t),{order:1})]:r<n?[W(W({},t),{order:r+2})]:[W(W({},t),{order:r+1})],!1)}),[]):t}(function(e,n,t){return e.reduce((function(r,a){var o,l,u="";if("element"===t){var c=a.label,i=null===(o=k[c])||void 0===o?void 0:o.backgroundColor;u=i||"aqua"}else c=a.label,i=null===(l=w[c])||void 0===l?void 0:l.backgroundColor,u=i||"aqua";var d=M(M({},a),{fill:!0,tension:.2,backgroundColor:u,pointStyle:function(){return"circle"},pointRadius:function(){return 3},pointBackgroundColor:function(){return u},pointHoverRadius:20,segment:{}}),f=function(e,n){var t=n.map((function(e){return e.data.map((function(e,n,t){var r;return Number(e.y)<Number(null===(r=t[n+1])||void 0===r?void 0:r.y)}))})),r=n.map((function(e){return e.data.map((function(e,n,t){var r;return Number(e.y)>Number(null===(r=t[n+1])||void 0===r?void 0:r.y)}))}));return{"up-trend":{borderColor:function(n){return e.includes("down-trend")?S(n,"red","blue"):function(e,n){return e.p0.parsed.y<e.p1.parsed.y?"red":void 0}(n)}},"down-trend":{borderColor:function(n){return e.includes("up-trend")?S(n,"red","blue"):function(e,n){return e.p0.parsed.y>e.p1.parsed.y?"blue":void 0}(n)}},"up-trend-overlap":{isOverlap:!1,upTrands:t,downTrands:r,backgroundColor:e.includes("down-trend-overlap")?N:function(e,n){var t=n.upTrands,r=e.datasetIndex,a=e.p0DataIndex,o=!0;return t[r][a]?t.forEach((function(e){!1===e[a]&&(o=!1)})):o=!1,o?"red":void 0}},"down-trend-overlap":{isOverlap:!1,upTrands:t,downTrands:r,backgroundColor:e.includes("up-trend-overlap")?N:function(e,n){var t=n.downTrands,r=e.datasetIndex,a=e.p0DataIndex,o=!0;return t[r][a]?t.forEach((function(e){!1===e[a]&&(o=!1)})):o=!1,o?"green":void 0}},"overlap-of-downtrends-and-uptrends":{isOverlap:!1,downTrands:r,upTrands:t,backgroundColor:function(e,n){var t=n.downTrands,r=n.upTrands,a=e.datasetIndex,o=e.p0DataIndex,l=!0,u=!0;return t[a][o]?t.forEach((function(e){!1===e[o]&&(l=!1)})):l=!1,r[a][o]?r.forEach((function(e){!1===e[o]&&(u=!1)})):u=!1,l?"rgba(0, 0, 100, 0.3)":u?"rgba(100, 0, 0, 0.3)":void 0}}}}(n,e);return n.forEach((function(e){if(e in f&&(d.segment=M({},f[e])),"min"===e&&n.includes("max")){var t=A(d.data.map((function(e){return e.y?e.y:0}))),r=j(d.data.map((function(e){return e.y?e.y:0})));d.pointStyle=function(e){return-1!==t.indexOf(e.dataIndex)||-1!==r.indexOf(e.dataIndex)?"rectRot":"circle"},d.pointRadius=function(e){return-1!==t.indexOf(e.dataIndex)||-1!==r.indexOf(e.dataIndex)?12:3},d.pointBackgroundColor=function(e){return-1!==t.indexOf(e.dataIndex)?"green":-1!==r.indexOf(e.dataIndex)?"red":d.backgroundColor}}else if("min"===e){var a=A(d.data.map((function(e){return e.y?e.y:0})));d.pointStyle=function(e){return-1!==a.indexOf(e.dataIndex)?"rectRot":"circle"},d.pointBackgroundColor=function(e){return-1!==a.indexOf(e.dataIndex)?"green":d.backgroundColor},d.pointRadius=function(e){return-1!==a.indexOf(e.dataIndex)?12:3}}else if("max"===e){var o=j(d.data.map((function(e){return e.y?e.y:0})));d.pointStyle=function(e){return-1!==o.indexOf(e.dataIndex)?"rectRot":"circle"},d.pointRadius=function(e){return-1!==o.indexOf(e.dataIndex)?12:3},d.pointBackgroundColor=function(e){return-1!==o.indexOf(e.dataIndex)?"red":d.backgroundColor}}})),q(q([],r,!0),[d],!1)}),[])}((n=re,t=le,i=D([],e=Oe,!0),n.forEach((function(n){R[n]&&(i=R[n](e,t))})),i),ee,F),be);return a().createElement(a().Fragment,null,a().createElement(u.Z,{variant:"h1"},T("weather-forecast")),a().createElement(c.Z,{container:!0,columns:12},a().createElement(c.Z,{xs:12},a().createElement(u.Z,{variant:"h3"},T("compare")),a().createElement(m.Z,null,a().createElement(s.Z,{row:!0,"aria-labelledby":"compare",name:"compare-group",value:F,onChange:he},a().createElement(p.Z,{value:"location",control:a().createElement(f.Z,null),label:T("location")}),a().createElement(p.Z,{value:"element",control:a().createElement(f.Z,null),label:T("element")}))))),a().createElement(c.Z,{container:!0,columns:12},a().createElement(c.Z,{xs:12},a().createElement(v.Z,{id:"compare"},a().createElement(u.Z,{variant:"h3"},T("condition"))))),a().createElement(c.Z,{container:!0,columns:12},a().createElement(c.Z,{xs:12,md:3},"location"===F?a().createElement(o.i,{label:T("location-multiple"),defaultSelected:H,options:fe,callback:ge}):a().createElement(L.q,{label:T("location"),defaultSelected:H[0],options:fe,callback:ge})),a().createElement(c.Z,{xs:12,md:3},"element"===F?a().createElement(o.i,{label:T("element-multiple"),options:se,defaultSelected:X,callback:we}):a().createElement(L.q,{label:T("element"),options:se,defaultSelected:X[0],callback:we})),a().createElement(c.Z,{xs:12,md:3},a().createElement(o.i,{label:T("label"),options:pe,value:ee,callback:Ce})),a().createElement(c.Z,{xs:12,md:3},a().createElement(L.q,{label:T("derivatives"),value:re,options:me,callback:Te}),re.includes("difference")?a().createElement("div",null,a().createElement(u.Z,{component:"span"},T("difference")),a().createElement("div",null,le.map((function(e,n){return a().createElement("div",{style:{display:"flex"},key:n},a().createElement(L.q,{defaultSelected:e[0],options:ve,callback:function(e){xe(n,0,e)}}),a().createElement("div",null,"-"),a().createElement(L.q,{defaultSelected:e[1],options:ve,callback:function(e){xe(n,1,e)}}),a().createElement("button",{onClick:function(){return ke(n)}},"delete"))})),a().createElement("div",null,a().createElement("button",{onClick:Ee},"createBiasPairs")))):null)),a().createElement(c.Z,{container:!0},a().createElement(c.Z,{xs:12},a().createElement(Q.U,null,a().createElement(u.Z,{variant:"h2"},ye)),a().createElement(B.K,{chart:ce.current}),a().createElement(d.kL,{type:"line",ref:ce,data:{datasets:Ze},options:{scales:{y:{labels:["1"],offset:!0,title:{display:!0,text:"°C",color:"light"===ie?"#1b1b1f":"#e3e2e6",font:{size:32}},ticks:{color:"light"===ie?"#1b1b1f":"#e3e2e6"},grid:{display:!1}},x:{alignToPixels:!0,offset:!0,ticks:{color:"light"===ie?"#1b1b1f":"#e3e2e6",callback:function(e,n){var t=this.getLabelForValue(n).split("-");return t.shift(),t.join("/")}},title:{display:!0,text:T("time"),color:"light"===ie?"#1b1b1f":"#e3e2e6",font:{size:32,family:"sans-serif, 'Noto Sans TC'"}},grid:{display:!1}}},plugins:{legend:{display:!1}}},plugins:[P]}))))}}}]);